@using System.Security.Claims

@{
    Layout = "_Layout";

    // Get the ClaimsIdentity object directly
    var claimsIdentity = User.Identity as ClaimsIdentity;

    // Declare and initialize the user's roles array
    string[]? userRoles = claimsIdentity?.Claims
                                        .Where(claim => claim.Type == ClaimTypes.Role)
                                        .Select(claim => claim.Value)
                                        .ToArray();
}

<!--Bootstrap Datatable-->
<link rel="stylesheet" type="text/css" href="~/Template/app-assets/vendors/css/tables/datatable/dataTables.bootstrap5.min.css">
<link rel="stylesheet" type="text/css" href="~/Template/app-assets/vendors/css/tables/datatable/responsive.bootstrap5.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.3.2/css/buttons.dataTables.min.css">
<link rel="stylesheet" type="text/css" href="~/Template/app-assets/vendors/css/tables/datatable/buttons.bootstrap5.min.css">
<link rel="stylesheet" type="text/css" href="~/Template/app-assets/vendors/css/tables/datatable/rowGroup.bootstrap5.min.css">
<link rel="stylesheet" type="text/css" href="~/Template/app-assets/vendors/css/forms/select/select2.min.css">
<link href="~/css/jquery.loadingmodal.css" rel="stylesheet" />

<!-- Zero configuration table -->
<section id="basic-datatable">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Factibilidades</h4>
                    <button type="button" id="addFactibilidad" name="addFactibilidad" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#modalAgregarFactibilidad" onclick="ResetModal()">
                        Agregar Estudio
                    </button>
                </div>
                <div class="card-content">
                    <div class="card-body card-dashboard">
                        <div class="table-responsive col-md-12">
                            <table class="table zero-configuration nowrap" id="factibilidadesTable">
                                <thead>
                                    <tr style="width:100%">
                                        <th></th>
                                        <th></th>
                                        <th>
                                            @if (userRoles != null && userRoles.Contains("Admin"))
                                            {
                                                <select class="form-control" id="serviceTypeFilter">
                                                    <option value=""></option>
                                                </select>
                                            }

                                        </th>
                                        <th>
                                            @if (userRoles != null && userRoles.Contains("Admin"))
                                            {
                                                <select class="form-control" id="clientFilter">
                                                    <option value=""></option>
                                                </select>
                                            }
                                        </th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                    <tr>
                                        <th>Ticket</th>
                                        <th>Detalle</th>
                                        <th>Tipo de Servicio</th>
                                        <th>Cliente</th>
                                        <th>KAM</th>
                                        <th>BW(Mbps)</th>
                                        <th>Fecha Solicitud</th>
                                        <th>Fecha Respuesta</th>
                                        <th>Estado</th>
                                        <th>Sitio Con Cobertura</th>
                                        <th>Sitio Con Cobertura Parcial</th>
                                        <th>Sitio Sin Cobertura</th>
                                        <th>Sitios analizados</th>
                                        <th>Ingeniero</th>
                                        <th>Acción</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Modal Agregar Factibilidad -->
<div class="modal fade fade text-start" id="modalAgregarFactibilidad" tabindex="-1" role="dialog" aria-labelledby="myModalLabel33" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel33"> Agregar un Estudio </h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="ResetModal()" id="closeModalAgregarFactibilidad">
                    @* <span aria-hidden="true">&times;</span>*@
                </button>
            </div>
            <div class="modal-body">
                <form id="form-factibilidad" name="form-factibilidad" method="post">
                    <div class="modal-body">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-md-12">
                                    <label>Detalle: </label>
                                    <div class="mb-1">
                                        <input type="text" id="Estudio" name="Estudio" placeholder="Detalle Estudio" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label>Ticket: </label>
                                    <div class="mb-1">
                                        <input type="number" id="Ticket" name="Ticket" placeholder="Ingrese Ticket" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <label>Cliente: </label>
                                    <div class="input-group mb-1">
                                        <select class="form-control col-md-12" id="selectCliente" name="selectCliente">
                                            <option value="">Seleccione una opción</option>
                                        </select>
                                        <div class="input-group-append">
                                            <button class="btn btn-primary" id="btn-add-client" type="button">
                                                <i data-feather="plus-circle"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label>KAM: </label>
                                    <div class="mb-1">
                                        <select class="form-control col-md-12" id="selectKAM" name="selectKAM">
                                            <option value="">Seleccione una opción</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label>BW: </label>
                                    <div class="mb-1">
                                        <input type="number" id="BW" name="BW" placeholder="Ancho de Banda" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label>Fecha Solicitud</label>
                                    <div class="mb-1">
                                        <input id="fechaSolicitud" name="fechaSolicitud" class="form-control" type="datetime-local" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label>Fecha Respuesta</label>
                                    <div class="mb-1">
                                        <input id="fechaRespuesta" name="fechaRespuesta" class="form-control" type="datetime-local" />
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label>Sitios Con Cobertura: </label>
                                    <div class="mb-1">
                                        <input type="number" id="SitioConCobertura" name="SitioConCobertura" placeholder="Sitios Con Cobertura" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label>Sitios Con Cobertura Parcial: </label>
                                    <div class="mb-1">
                                        <input type="number" id="SitioConCoberturaParcial" name="SitioConCoberturaParcial" placeholder="Sitios Con Cobertura Parcial" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label>Sitios Sin Cobertura: </label>
                                    <div class="mb-1">
                                        <input type="number" id="SitioSinCobertura" name="SitioSinCobertura" placeholder="Sitios Sin Cobertura" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label>Tipo de Servicio: </label>
                                    <div class="mb-1">
                                        <select class="form-control col-md-12" id="selectTipoServicio" name="selectTipoServicio">
                                            <option value="">Seleccione una opción</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" id="btnGuardarFactibilidad">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Modal Agregar Factibilidad Fin -->


<!-- Modal Editar Factibilidad -->
<div class="modal fade fade text-start" id="modalEditarFactibilidad" tabindex="-1" role="dialog" aria-labelledby="myModalLabel33" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel33"> Editar un Estudio </h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="ResetModal()" id="closeModalEditarFactibilidad">
                    @* <span aria-hidden="true">&times;</span>*@
                </button>
            </div>
            <div class="modal-body">
                <form id="form-factibilidade" name="form-factibilidade" method="post">
                    <div class="modal-body">
                        <input type="hidden" id="IdFactibilidade" name="IdFactibilidade" placeholder="" class="form-control">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-md-12">
                                    <label>Detalle: </label>
                                    <div class="mb-1">
                                        <input type="text" id="Estudioe" name="Estudioe" placeholder="Detalle Estudio" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label>Ticket: </label>
                                    <div class="mb-1">
                                        <input type="number" id="Tickete" name="Tickete" placeholder="Ingrese Ticket" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <label>Cliente: </label>
                                    <div class="input-group mb-1">
                                        <select class="form-control col-md-12" id="selectClientee" name="selectClientee">
                                            <option value="">Seleccione una opción</option>
                                        </select>
                                        <div class="input-group-append">
                                            <button class="btn btn-primary" id="btn-add-cliente" type="button">
                                                <i data-feather="plus-circle"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label>KAM: </label>
                                    <div class="mb-1">
                                        <select class="form-control col-md-12" id="selectKAMe" name="selectKAMe">
                                            <option value="">Seleccione una opción</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label>BW: </label>
                                    <div class="mb-1">
                                        <input type="number" id="BWe" name="BWe" placeholder="Ancho de Banda" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label>Fecha Solicitud</label>
                                    <div class="mb-1">
                                        <input id="fechaSolicitude" name="fechaSolicitude" class="form-control" type="datetime-local" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label>Fecha Respuesta</label>
                                    <div class="mb-1">
                                        <input id="fechaRespuestae" name="fechaRespuestae" class="form-control" type="datetime-local" />
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label>Sitios Con Cobertura: </label>
                                    <div class="mb-1">
                                        <input type="number" id="SitioConCoberturae" name="SitioConCoberturae" placeholder="Sitios Con Cobertura" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label>Sitios Con Cobertura Parcial: </label>
                                    <div class="mb-1">
                                        <input type="number" id="SitioConCoberturaParciale" name="SitioConCoberturaParciale" placeholder="Sitios Con Cobertura Parcial" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label>Sitios Sin Cobertura: </label>
                                    <div class="mb-1">
                                        <input type="number" id="SitioSinCoberturae" name="SitioSinCoberturae" placeholder="Sitios Sin Cobertura" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label>Tipo de Servicio: </label>
                                    <div class="mb-1">
                                        <select class="form-control col-md-12" id="selectTipoServicioe" name="selectTipoServicioe">
                                            <option value="">Seleccione una opción</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" id="btnEditarFactibilidad">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Modal Editar Factibilidad Fin -->

<!-- Modal Agregar Cliente -->
<div class="modal fade fade text-start" id="modalAgregarCliente" tabindex="-1" role="dialog" aria-labelledby="myModalLabel33" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel33"> Agregar Cliente </h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="ResetModal()" id="closeModalAgregarCliente">
                    @* <span aria-hidden="true">&times;</span>*@
                </button>
            </div>
            <div class="modal-body">
                <form id="form-add-client" name="form-add-client" method="post">
                    <div class="modal-body">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-md-12">
                                    <label>Nombre Cliente: </label>
                                    <div class="mb-1">
                                        <input type="text" id="addClientInput" name="addClientInput" placeholder="Agregar Cliente" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" id="btn-save-client">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Modal Agregar Cliente Fin -->

@section Scripts {
    <!-- Bootstrap datatable -->
    <script src="~/Template/app-assets/vendors/js/tables/datatable/jquery.dataTables.min.js"></script>
    <script src="~/Template/app-assets/vendors/js/tables/datatable/dataTables.bootstrap5.min.js"></script>
    <script src="~/Template/app-assets/vendors/js/tables/datatable/dataTables.responsive.min.js"></script>
    <script src="~/Template/app-assets/vendors/js/tables/datatable/responsive.bootstrap5.min.js"></script>
    <script src="~/Template/app-assets/vendors/js/tables/datatable/datatables.checkboxes.min.js"></script>
    <script src="~/Template/app-assets/vendors/js/tables/datatable/datatables.buttons.min.js"></script>
    <script src="~/Template/app-assets/vendors/js/tables/datatable/jszip.min.js"></script>
    <script src="~/Template/app-assets/vendors/js/tables/datatable/pdfmake.min.js"></script>
    <script src="~/Template/app-assets/vendors/js/tables/datatable/vfs_fonts.js"></script>
    <script src="~/Template/app-assets/vendors/js/tables/datatable/buttons.html5.min.js"></script>
    <script src="~/Template/app-assets/vendors/js/tables/datatable/buttons.print.min.js"></script>
    <script src="~/Template/app-assets/vendors/js/tables/datatable/dataTables.rowGroup.min.js"></script>
    <!-- end Bootstrap datatable -->
    <script src="~/Template/app-assets/vendors/js/forms/select/select2.full.min.js"></script>
    <script src="~/Template/app-assets/js/scripts/forms/form-select2.js"></script>
    <script src="~/Template/app-assets/vendors/js/forms/validation/jquery.validate.min.js"></script>
    <!-- Mensaje cargando-->
    <script src="~/js/jquery.loadingModal.js"></script>
    <!-- Alertas-->
    <script src="~/js/sweetalert2.all.min.js"></script>

    <script>

        $(document).ready(function () {

            $('#factibilidadesTable').DataTable({
                "language": { "url": "https://cdn.datatables.net/plug-ins/1.12.1/i18n/es-ES.json" },
                processing: true,
                serverSide: true,
                searching: true,
                ordering: true,
                paging: true,
                lengthMenu: [
                    [10, 25, 50, 100, -1],
                    ['10', '25', '50', '100', 'Todo']
                ],
                "ajax": {
                    "url": "@Url.Action("ListaFactibilidadesPaginate", "Indicadores")",
                    "type": "POST",
                    "dataType": "json"
                },
                "order": [[0, "desc"]],
                dom: 'lBfrtip',
                buttons: [
                    { extend: 'excel', className: 'btn btn-success' }
                ],
                columns: [
                    { "data": "ticket" },
                    { "data": "estudio" },
                    { "data": "tipoServicio" },
                    { "data": "cliente" },
                    { "data": "kam" },
                    { "data": "bw", render: $.fn.dataTable.render.number( ',', '.', 0)},
                    { "data": "fechaSolicitud" },
                    { "data": "fechaRespuesta" },
                    { "data": "estado" },
                    { "data": "sitioConCobertura" },
                    { "data": "sitioConCoberturaParcial" },
                    { "data": "sitioSinCobertura" },
                    { "data": "sitiosAnalizados" },
                    { "data": "ingeniero" },
                    {
                        'defaultContent': null,
                        'render': function (data, type, row) {
                            return '<div class="d-flex"> <button type="button" class="btn btn-icon btn-warning mx-1" id="' + row.idFactibilidad + '" onclick="detallesFactibilidad(this.id)" data-toggle="tooltip" data-placement="left" title="Modificar"> <i data-feather="edit"></i></i> </button> <button type="button" class="btn btn-icon btn-danger mx-1" id="' + row.idFactibilidad + '" onclick="eliminarFactibilidad(this.id)" data-toggle="tooltip" data-placement="left" title="Eliminar"> <i data-feather="trash"></i> </button> </div>'
                        }
                    }
                ],
                rowCallback: function (row, data) {
                    if (data.estado === 'Activo') {
                        $($(row).find("td")[8]).css("color", "green");
                    }
                    else {
                        $($(row).find("td")[8]).css("color", "#E60026");
                    }
                    //Colocar color a Sitios
                    //Sitios Con Cobertura
                    $($(row).find("td")[9]).css("color", "#43F30B");
                    //Sitios Con Cobertura Parcial
                    $($(row).find("td")[10]).css("color", "#F8E207");
                    //Sitios Sin Cobertura
                    $($(row).find("td")[11]).css("color", "#F80719");
                    //Sitios Totales
                    $($(row).find("td")[12]).css("color", "#DE07F8");
                },
                drawCallback: function (settings) {
                    feather.replace();
                },
                initComplete: function () {
                    var api = this.api();

                    // Crear el filtro desplegable para la columna "Tipo de Servicio"
                    api.column(2, { search: 'applied' }).data().unique().sort().each(function (d, j) {
                        $('#serviceTypeFilter').append('<option value="' + d + '">' + d + '</option>');
                    });

                    // Crear el filtro desplegable para la columna "Tipo de Servicio"
                    api.column(3, { search: 'applied' }).data().unique().sort().each(function (d, j) {
                        $('#clientFilter').append('<option value="' + d + '">' + d + '</option>');
                    });

                    // Agregar el evento de cambio al filtro desplegable
                    $('#serviceTypeFilter').on('change', function () {
                        var val = $.fn.dataTable.util.escapeRegex($(this).val());
                        api.column(2).search(val ? val  : '', true, false).draw();
                    });

                    // Agregar el evento de cambio al filtro desplegable
                    $('#clientFilter').on('change', function () {
                        var val = $.fn.dataTable.util.escapeRegex($(this).val());
                        api.column(3).search(val ? val : '', true, false).draw();
                    });
                }

            });

            cargarSelect();

        });

        function cargarSelect() {
            //Clientes
            $.get("@Url.Action("selectClientes","Indicadores")", function (data) {

                $("#selectCliente").empty();
                $("#selectClientee").empty();

                $.each(data, function (index, row) {
                    $("#selectCliente").append("<option value='" + row.idCliente + "'>" + row.nombre + "</option>");
                    $("#selectClientee").append("<option value='" + row.idCliente + "'>" + row.nombre + "</option>")

                });
                $("#selectCliente").append("<option selected disabled hidden value='0'>" + "Por Favor Seleccione cliente" + "</option>");
            });

            //KAMs
            $.get("@Url.Action("selectKAM","Indicadores")", function (data) {

                $("#selectKAM").empty();
                $("#selectKAMe").empty();

                $.each(data, function (index, row) {
                    $("#selectKAM").append("<option value='" + row.idKAM + "'>" + row.nombre + "</option>");
                    $("#selectKAMe").append("<option value='" + row.idKAM + "'>" + row.nombre + "</option>")

                });
                $("#selectKAM").append("<option selected disabled hidden value='0'>" + "Por Favor Seleccione KAM" + "</option>");
            });

            //Tipos de Servicio
            $.get("@Url.Action("selectTiposServicios","Indicadores")", function (data) {

                $("#selectTipoServicio").empty();
                $("#selectTipoServicioe").empty();

                $.each(data, function (index, row) {
                    $("#selectTipoServicio").append("<option value='" + row.idTipoServicio+ "'>" + row.tipoServicio + "</option>");
                    $("#selectTipoServicioe").append("<option value='" + row.idTipoServicio + "'>" + row.tipoServicio + "</option>")

                });
                $("#selectTipoServicio").append("<option selected disabled hidden value='0'>" + "Por Favor Seleccione Tipo Servicio" + "</option>");
            });

        }

        //VALIDACION DE FORMULARIOS

        $("#form-factibilidad").validate({
            rules: {
                Estudio: "required",
                Ticket: "required",
                selectCliente: "required",
                selectKAM: "required",
                BW: "required",
                fechaSolicitud: "required",
                fechaRespuesta: "required",
                SitioConCobertura: "required",
                SitioConCoberturaParcial: "required",
                SitioSinCobertura: "required",
                selectTipoServicio: "required"
            },
            messages: {
                Estudio: "Ingrese Detalle",
                Ticket: "Ingrese Ticket",
                selectCliente: "Seleccione Cliente",
                selectKAM: "Seleccione KAM",
                BW: "Ingrese BW",
                fechaSolicitud: "Seleccione Fecha Solicitud",
                fechaRespuesta: "Seleccione Fecha Respuesta",
                SitioConCobertura: "Ingrese Sitios CC",
                SitioConCoberturaParcial: "Ingrese Sitios CCP",
                SitioSinCobertura: "Ingrese Sitios SC",
                selectTipoServicio: "Ingrese Tipo servicio"
            },
            submitHandler: function (form) {
                event.preventDefault();
                agregarFactibilidad();
            }
        });

        $("#form-factibilidade").validate({
            ignore: [],
            rules: {
                Estudioe: "required",
                Tickete: "required",
                selectClientee: "required",
                selectKAMe: "required",
                BWe: "required",
                fechaSolicitude: "required",
                fechaRespuestae: "required",
                SitioConCoberturae: "required",
                SitioConCoberturaParciale: "required",
                SitioSinCoberturae: "required",
                selectTipoServicioe: "required"
            },
            messages: {
                Estudioe: "Ingrese Detalle",
                Tickete: "Ingrese Ticket",
                selectClientee: "Seleccione Cliente",
                selectKAMe: "Seleccione KAM",
                BWe: "Ingrese BW",
                fechaSolicitude: "Seleccione Fecha Solicitud",
                fechaRespuestae: "Seleccione Fecha Respuesta",
                SitioConCoberturae: "Ingrese Sitios CC",
                SitioConCoberturaParciale: "Ingrese Sitios CCP",
                SitioSinCoberturae: "Ingrese Sitios SC",
                selectTipoServicioe: "Ingrese Tipo servicio"
            },
            submitHandler: function (form) {
                event.preventDefault();
                editarFactibilidad();
            }
        });

        $("#form-add-client").validate({
            ignore: [],
            rules: {
                addClientInput: "required"
            },
            messages: {
                addClientInput: "Ingrese Nombre"
            },
            submitHandler: function (form) {
                event.preventDefault();
                addClient();
            }
        });

        //EVENTOS
        $("#btn-add-client").on("click", function () {
            $("#modalAgregarCliente").modal("show");
        });

        $("#btn-add-cliente").on("click", function () {
            $("#modalAgregarCliente").modal("show");
        });


        //FUNCIONES

        function ResetModal() {
            var validator = $("#modalAgregarFactibilidad").validate();
            validator.resetForm();
            $("#Estudio").val("");
            $("#Ticket").val("");
            $("#selectCliente").val(0);
            $("#selectKAM").val(0);
            $("#BW").val("");
            $("#fechaSolicitud").val("");
            $("#fechaRespuesta").val("");
            $("#SitioConCobertura").val("");
            $("#SitioConCoberturaParcial").val("");
            $("#SitioSinCobertura").val("");
            $("#selectTipoServicio").val(0);
        }

        function ResetModalEditar() {
            var validator = $("#modalEditarFactibilidad").validate();
            validator.resetForm();
            $("#Estudioe").val("");
            $("#Tickete").val("");
            $("#selectClientee").val(0);
            $("#selectKAMe").val(0);
            $("#BWe").val("");
            $("#fechaSolicitude").val("");
            $("#fechaRespuestae").val("");
            $("#SitioConCoberturae").val("");
            $("#SitioConCoberturaParciale").val("");
            $("#SitioSinCoberturae").val("");
            $("#selectTipoServicioe").val(0);
        }

        function agregarFactibilidad() {
            //mensaje carga
            $('body').loadingModal({
                position: 'auto',
                text: 'Cargando',
                color: '#fff',
                opacity: '0.7',
                backgrundColor: 'rgb(0,0,0)',
                animation: 'doubleBounce'
            });

            //objeto
            var estudio = $("#Estudio").val();
            var ticket = $("#Ticket").val();
            var cliente = $("#selectCliente").val();
            var kam = $("#selectKAM").val();
            var bw = $("#BW").val();
            var fechaSolicitud = $("#fechaSolicitud").val();
            var fechaRespuesta = $("#fechaRespuesta").val();
            var sitioConCobertura = $("#SitioConCobertura").val();
            var sitioConCoberturaParcial = $("#SitioConCoberturaParcial").val();
            var sitioSinCobertura = $("#SitioSinCobertura").val();
            var tipoServicio = $("#selectTipoServicio").val();

            var parametros = JSON.stringify({ 
                Estudio: estudio, 
                Ticket: ticket,
                Cliente: cliente,
                KAM: kam,
                BW: bw,
                FechaSolicitud: fechaSolicitud,
                FechaRespuesta: fechaRespuesta,
                SitioConCobertura : sitioConCobertura,
                SitioConCoberturaParcial: sitioConCoberturaParcial,
                SitioSinCobertura: sitioSinCobertura,
                IdTipoServicio: tipoServicio
            });

            $.ajax({
                url: "@Url.Action("CrearFactibilidad", "Indicadores")",
                type: "POST",
                contentType: "application/json; charset=utf-8",
                data: parametros,
                dataType: "json",
                success: function (result) {
                    //show Alert
                    Swal.fire({
                        title: 'Crear Factibilidad',
                        text: result.mensaje,
                        icon: result.tipo
                    })
                    //$("#modalAgregarUsuario").modal('hide');
                    $('#closeModalAgregarFactibilidad').trigger("click");

                    //reload table
                    var table = $('#factibilidadesTable').DataTable();
                    table.ajax.reload();
                    //hidemodal loading
                    $('body').loadingModal('destroy');
                },
                error: function (result) {
                    Swal.fire({
                        title: 'Crear Factibilidad',
                        text: result.Mensaje,
                        icon: result.Tipo
                    })
                    //hidemodal loading
                    $('body').loadingModal('destroy');

                }
            });
        }

        function detallesFactibilidad(id) {
            //Modal Loading
            $('body').loadingModal({
                position: 'auto',
                text: 'Cargando',
                color: '#fff',
                opacity: '0.7',
                backgrundColor: 'rgb(0,0,0)',
                animation: 'doubleBounce'
            });

            $.ajax({
                url: "@Url.Action("DetallesFactibilidad", "Indicadores")",
                type: "POST",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify({ IdFactibilidad: id }),
                success: function (result) {

                    $("#IdFactibilidade").val(result.idFactibilidad);
                    $("#Estudioe").val(result.estudio);
                    $("#Tickete").val(result.ticket);
                    $("#selectClientee").val(result.idCliente);
                    $("#selectKAMe").val(result.idKAM);
                    $("#BWe").val(result.bw);
                    $("#fechaSolicitude").val(result.fechaSolicitud);
                    $("#fechaRespuestae").val(result.fechaRespuesta);
                    $("#SitioConCoberturae").val(result.sitioConCobertura);
                    $("#SitioConCoberturaParciale").val(result.sitioConCoberturaParcial);
                    $("#SitioSinCoberturae").val(result.sitioSinCobertura);
                    $("#selectTipoServicioe").val(result.idTipoServicio);

                    $("#modalEditarFactibilidad").modal("show")

                    $('body').loadingModal('destroy');
                },
                error: function (result) {
                    //show Alert
                    Swal.fire({
                        title: "HA OCURRIDO UN ERROR",
                        text: "Error en el Servidor" + result.responseText,
                        icon: "error"
                    })
                    //hidemodal loading
                    $('body').loadingModal('destroy');

                }
            });
        }

        function editarFactibilidad() {
            //mensaje carga
            $('body').loadingModal({
                position: 'auto',
                text: 'Cargando',
                color: '#fff',
                opacity: '0.7',
                backgrundColor: 'rgb(0,0,0)',
                animation: 'doubleBounce'
            });

            //objeto
            var id = $("#IdFactibilidade").val();
            var estudio = $("#Estudioe").val();
            var ticket = $("#Tickete").val();
            var cliente = $("#selectClientee").val();
            var kam = $("#selectKAMe").val();
            var bw = $("#BWe").val();
            var fechaSolicitud = $("#fechaSolicitude").val();
            var fechaRespuesta = $("#fechaRespuestae").val();
            var sitioConCobertura = $("#SitioConCoberturae").val();
            var sitioConCoberturaParcial = $("#SitioConCoberturaParciale").val();
            var sitioSinCobertura = $("#SitioSinCoberturae").val();
            var tipoServicio = $("#selectTipoServicioe").val();

            var parametros = JSON.stringify({ 
                IdFactibilidad: id, 
                Estudio: estudio, 
                Ticket: ticket,
                Cliente: cliente,
                KAM: kam,
                BW: bw,
                FechaSolicitud: fechaSolicitud,
                FechaRespuesta: fechaRespuesta,
                SitioConCobertura : sitioConCobertura,
                SitioConCoberturaParcial: sitioConCoberturaParcial,
                SitioSinCobertura: sitioSinCobertura,
                IdTipoServicio: tipoServicio
            });

            $.ajax({
                url: "@Url.Action("EditarFactibilidad", "Indicadores")",
                type: "POST",
                contentType: "application/json; charset=utf-8",
                data: parametros,
                dataType: "json",
                success: function (result) {
                    //show Alert
                    Swal.fire({
                        title: 'Editar Factibilidad',
                        text: result.mensaje,
                        icon: result.tipo
                    })
                    //$("#modalAgregarUsuario").modal('hide');
                    $('#closeModalEditarFactibilidad').trigger("click");

                    //reload table
                    var table = $('#factibilidadesTable').DataTable();
                    table.ajax.reload();
                    //hidemodal loading
                    $('body').loadingModal('destroy');
                },
                error: function (result) {
                    Swal.fire({
                        title: 'Editar Factibilidad',
                        text: result.Mensaje,
                        icon: result.Tipo
                    })
                    //hidemodal loading
                    $('body').loadingModal('destroy');

                }
            });
        }

         function eliminarFactibilidad(id) {
            Swal.fire({
                title: "¿DESACTIVAR FACTIBILIDAD?",
                text: "¿Está seguro que desea desactivar esta factibilidad? con Id "+ id,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, Desactivar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    //Modal Loading
                    $('body').loadingModal({
                        position: 'auto',
                        text: 'Cargando',
                        color: '#fff',
                        opacity: '0.7',
                        backgrundColor: 'rgb(0,0,0)',
                        animation: 'doubleBounce'
                    });

                    $.ajax({
                        url: "@Url.Action("DesactivarFactibilidad","Indicadores")",
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: JSON.stringify({ IdFactibilidad: id }),
                        success: function (result) {
                            //show Alert
                            Swal.fire({
                                title: 'DESACTIVAR FACTIBILIDAD',
                                text: result.mensaje,
                                icon: result.tipo
                            })

                            //reload table
                            var table = $('#factibilidadesTable').DataTable();
                            table.ajax.reload();
                            //hidemodal loading
                            $('body').loadingModal('destroy');
                        },
                        error: function (result) {
                            //show Alert
                            Swal.fire({
                                title: "HA OCURRIDO UN ERROR",
                                text: "Error en el Servidor" + result.responseText,
                                icon: "error"
                            })
                            //hidemodal loading
                            $('body').loadingModal('destroy');

                        }
                    });

                }
            });
        }

        function addClient() {
            //Modal Loading
            $('body').loadingModal({
                position: 'auto',
                text: 'Cargando',
                color: '#fff',
                opacity: '0.7',
                backgrundColor: 'rgb(0,0,0)',
                animation: 'doubleBounce'
            });


            $.ajax({
                url: "@Url.Action("AddClient", "Indicadores")",
                type: 'POST',
                data: {
                    clientName: $("#addClientInput").val()
                },
                dataType: 'json',
                success: function (response) {
                    if (response) {
                        $("#modalAgregarCliente").modal("hide");
                        $("#addClientInput").val("");
                        cargarSelect();
                    } 
                    $('body').loadingModal('destroy');
                },
                error: function (xhr, status, error) {
                    $('body').loadingModal('destroy');
                }
            });
        }
    </script>
}